import { useState } from "react";
import styled from "styled-components";
import { Skeleton, message } from "antd";

const Container = styled.div`
  max-width: 640px;
  margin: 0px auto;
  background: linear-gradient(180deg, #0e1647 0%, #0a1033 100%);
  font-family: Poppins;
  padding: 20px 20px;
  min-height: 100vh;
`;

const Title = styled.h2`
  color: white;
  font-weight: 500;
  text-align: center;
`;

const Input = styled.input`
  border: none;
  width: 100%;
  margin-top: 10px;
  padding: 10px;
  border-radius: 8px;
  background: #1d2766;
  color: white;
  outline: none;
`;

const Button = styled.button`
  background: #e61c44;
  border: none;
  color: white;
  width: 100%;
  margin-top: 20px;
  padding: 10px 10px;
  font-weight: bold;
  border-radius: 8px;
`;

const Item = styled.div`
  border-radius: 8px;
  margin-top: 20px;
  padding: 10px 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  border-bottom: 1px solid #1d2766;

  a {
    text-decoration: none;
    color: white;
    font-weight: 500;
    margin-left: 20px;
  }
`;

const qualityList = ["320", "256", "192", "128"];

const Icon = () => (
  <Title>
    <svg
      width={216}
      height={35}
      viewBox="0 0 216 35"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M12.524 29h-3.4c-.56 0-.84-.28-.84-.84V19.6L.964 4.16c-.106-.24-.106-.44 0-.6a.649.649 0 01.56-.28h4.24c.427 0 .747.28.96.84l4 9.72h.28l3.92-9.72c.187-.56.507-.84.96-.84h4.24c.267 0 .454.08.56.24.134.16.134.373 0 .64l-7.32 15.44v8.56c0 .56-.28.84-.84.84zm20.584 0h-3.56c-2.106 0-3.733-.56-4.88-1.68-1.146-1.12-1.72-2.733-1.72-4.84v-7.36c0-2.107.574-3.72 1.72-4.84 1.147-1.12 2.774-1.68 4.88-1.68h3.56c2.08 0 3.694.573 4.84 1.72 1.174 1.12 1.76 2.72 1.76 4.8v7.36c0 2.08-.586 3.693-1.76 4.84-1.146 1.12-2.76 1.68-4.84 1.68zm-2.8-4.36h2.04c.854 0 1.454-.173 1.8-.52.374-.347.56-.947.56-1.8v-7.04c0-.853-.186-1.453-.56-1.8-.346-.347-.946-.52-1.8-.52h-2.04c-.853 0-1.453.173-1.8.52-.346.347-.52.947-.52 1.8v7.04c0 .853.174 1.453.52 1.8.347.347.947.52 1.8.52zM51.06 29h-1.32c-2.053 0-3.613-.56-4.68-1.68-1.04-1.12-1.56-2.733-1.56-4.84V9.44c0-.56.28-.84.84-.84h3.4c.56 0 .84.28.84.84v12.8c0 .853.173 1.467.52 1.84.373.347.973.52 1.8.52h1.48c1.84 0 2.76-1.013 2.76-3.04V9.44c0-.56.28-.84.84-.84h3.36c.587 0 .88.28.88.84v18.72c0 .56-.293.84-.88.84h-3.36c-.56 0-.84-.28-.84-.84v-1.32h-.16c-.293.72-.813 1.267-1.56 1.64a5.538 5.538 0 01-2.36.52zm14.017-16h-1.6c-.32 0-.546-.053-.68-.16-.106-.107-.16-.32-.16-.64V9.44c0-.56.28-.84.84-.84h1.6c.294 0 .44-.147.44-.44v-3.8c0-.56.294-.84.88-.84h3.36c.56 0 .84.28.84.84v3.8c0 .293.16.44.48.44h3.12c.56 0 .84.28.84.84v2.76c0 .293-.066.507-.2.64-.106.107-.32.16-.64.16h-3.12c-.32 0-.48.147-.48.44v8.84c0 .827.187 1.427.56 1.8.374.347.987.52 1.84.52h1.6c.56 0 .84.28.84.84v2.76c0 .293-.066.507-.2.64-.106.107-.32.16-.64.16h-2.44c-2.106 0-3.746-.56-4.92-1.68-1.146-1.12-1.72-2.72-1.72-4.8v-9.08c0-.293-.146-.44-.44-.44zM86.1 29h-1.32c-2.053 0-3.613-.56-4.68-1.68-1.04-1.12-1.56-2.733-1.56-4.84V9.44c0-.56.28-.84.84-.84h3.4c.56 0 .84.28.84.84v12.8c0 .853.173 1.467.52 1.84.373.347.973.52 1.8.52h1.48c1.84 0 2.76-1.013 2.76-3.04V9.44c0-.56.28-.84.84-.84h3.36c.587 0 .88.28.88.84v18.72c0 .56-.293.84-.88.84h-3.36c-.56 0-.84-.28-.84-.84v-1.32h-.16c-.293.72-.813 1.267-1.56 1.64a5.538 5.538 0 01-2.36.52zm19.098-4.4h4.08c.853 0 1.453-.173 1.8-.52.373-.373.56-.987.56-1.84v-6.96c0-.853-.187-1.453-.56-1.8-.347-.373-.947-.56-1.8-.56h-1.76c-1.84 0-2.76 1.013-2.76 3.04v8.2c0 .293.146.44.44.44zm-5.52 3.56V1.72c0-.56.28-.84.84-.84h3.4c.56 0 .84.28.84.84v9h.16c.293-.72.813-1.267 1.56-1.64a5.206 5.206 0 012.36-.56h1.28c2.106 0 3.733.56 4.88 1.68 1.146 1.12 1.72 2.733 1.72 4.84v7.44c0 2.107-.574 3.72-1.72 4.84-1.147 1.12-2.774 1.68-4.88 1.68h-9.6c-.56 0-.84-.28-.84-.84zm36.094.84h-8.84c-2.106 0-3.733-.56-4.88-1.68-1.146-1.12-1.72-2.733-1.72-4.84v-7.36c0-2.107.574-3.72 1.72-4.84 1.147-1.12 2.774-1.68 4.88-1.68h3.16c2.107 0 3.734.56 4.88 1.68 1.147 1.12 1.72 2.733 1.72 4.84v5.08c0 .56-.28.84-.84.84h-10.04c-.32 0-.48.147-.48.44v.88c0 .827.174 1.427.52 1.8.374.347.987.52 1.84.52h8.08c.56 0 .84.293.84.88v2.64c0 .293-.066.507-.2.64-.106.107-.32.16-.64.16zm-9.96-11.36h5.44c.294 0 .44-.147.44-.44v-1.92c0-.853-.173-1.453-.52-1.8-.346-.347-.946-.52-1.8-.52h-1.68c-.853 0-1.453.173-1.8.52-.346.347-.52.947-.52 1.8v1.92c0 .293.147.44.44.44z"
        fill="#DDE3F0"
      />
      <path
        d="M166.766 3.28h5.92c.56 0 .84.28.84.84v24.04c0 .56-.28.84-.84.84h-3.28c-.56 0-.84-.28-.84-.84V9.2h-.16l-4.08 13.4c-.16.533-.493.8-1 .8h-3.36c-.507 0-.84-.267-1-.8l-4.16-13.44h-.16v19c0 .32-.053.547-.16.68-.107.107-.333.16-.68.16h-3.28c-.56 0-.84-.28-.84-.84V4.12c0-.56.28-.84.84-.84h5.96c.373 0 .627.187.76.56l4.24 14.12h.24l4.28-14.12c.08-.373.333-.56.76-.56zm15.783 31.16h-3.4c-.56 0-.84-.267-.84-.8V9.44c0-.56.28-.84.84-.84h3.4c.56 0 .84.28.84.84v1.32h.16c.294-.72.814-1.253 1.56-1.6a5.212 5.212 0 012.36-.56h1.64c2.054 0 3.6.56 4.64 1.68 1.067 1.12 1.6 2.733 1.6 4.84v7.36c0 2.107-.533 3.72-1.6 4.84-1.04 1.12-2.586 1.68-4.64 1.68h-1.64a5.541 5.541 0 01-2.36-.52c-.746-.373-1.266-.92-1.56-1.64h-.16v6.8c0 .533-.28.8-.84.8zm3.6-9.84h1.76c.854 0 1.454-.173 1.8-.52.374-.373.56-.987.56-1.84v-6.88c0-.853-.186-1.453-.56-1.8-.346-.373-.946-.56-1.8-.56h-1.76c-1.84 0-2.76 1.013-2.76 3.04v5.52c0 2.027.92 3.04 2.76 3.04zm19.775-10.56h2.04c.88 0 1.507-.173 1.88-.52.4-.373.6-.973.6-1.8V9.84c0-.827-.2-1.413-.6-1.76-.373-.373-1-.56-1.88-.56h-1.92c-.853 0-1.453.187-1.8.56-.347.347-.52.933-.52 1.76v1c0 .56-.28.84-.84.84h-3.4c-.56 0-.84-.28-.84-.84V9.76c0-2.08.573-3.68 1.72-4.8 1.147-1.12 2.773-1.68 4.88-1.68h3.56c2.107 0 3.733.56 4.88 1.68 1.147 1.12 1.72 2.72 1.72 4.8v2c0 2.24-1.053 3.693-3.16 4.36 2.107.453 3.16 1.907 3.16 4.36v2.04c0 2.08-.573 3.68-1.72 4.8-1.147 1.12-2.773 1.68-4.88 1.68h-3.56c-2.107 0-3.733-.56-4.88-1.68-1.147-1.12-1.72-2.72-1.72-4.8V21.4c0-.587.28-.88.84-.88h3.4c.56 0 .84.293.84.88v1.04c0 .853.173 1.453.52 1.8.347.347.947.52 1.8.52h1.92c.88 0 1.507-.173 1.88-.52.4-.373.6-.973.6-1.8v-1.96c0-.827-.2-1.413-.6-1.76-.373-.373-1-.56-1.88-.56h-2.04c-.56 0-.84-.28-.84-.84v-2.4c0-.587.28-.88.84-.88z"
        fill="#E51C44"
      />
    </svg>
  </Title>
);

const Image = styled.img`
  display: block;
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 8px;
  overflow: hidden;
`;

export default function Youtube() {
  const [link, setLink] = useState("");
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState([]);

  const onSubmit = () => {
    if (link != undefined || link != "") {
      setLoading(true);
      var regExp =
        /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/;
      var match = link.match(regExp);
      if (match && match[2].length == 11) {
        fetch("/api/youtube", {
          method: "post",
          headers: {
            "content-type": "application/json",
          },
          body: JSON.stringify({ youtubeId: match[2] }),
        })
          .then((res) => res.json())
          .then((response) => {
            setData(response.data);
            setLoading(false);
          });
      } else {
        message.error("Link yang anda masukan tidak valid!");
        setLoading(false);
      }
    }
  };

  return (
    <Container>
      <Icon />
      <Input
        placeholder="Masukan link youtube anda"
        onChange={(e) => setLink(e.target.value)}
      />
      <Button onClick={onSubmit}>Cari link Youtube</Button>
      {loading ? (
        <Skeleton active />
      ) : (
        <>
          <div style={{ height: 10 }} />
          {data.map((item, key) => (
            <Item key={key}>
              <Image src={item.cover} />
              <a href={item.link}>Kualitas {qualityList[key]} Kbps</a>
              <div style={{ flex: 1 }} />
              <a href={item.link} style={{ color: "#E51C44" }}>
                Download
              </a>
            </Item>
          ))}
        </>
      )}
    </Container>
  );
}
